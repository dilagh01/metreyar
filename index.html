<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>پردازش تصویر</title>
    <style>
        /* فونت اصلی قابل زوم */
        html {
            font-size: 16px; /* پایه برای rem */
        }
        body { 
            font-family: sans-serif; 
            text-align: center; 
            margin-top: 3rem; 
        }
        h1 { 
            font-size: 2rem; /* قابل تغییر با زوم مرورگر */
        }
        input { 
            font-size: 1rem; 
        }
        canvas { 
            border: 1px solid #000; 
            margin-top: 2rem; 
            max-width: 90%; /* برای موبایل و بزرگ‌نمایی */
            height: auto;
        }
    </style>
</head>
<body>

<h1>پردازش تصویر</h1>
<input type="file" id="upload" accept="image/*">
<br>
<canvas id="canvas"></canvas>

<script>
function enhanceText(imageElement) {
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = imageElement.width;
    canvas.height = imageElement.height;
    ctx.drawImage(imageElement, 0, 0);

    let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    let data = imageData.data;

    for (let i = 0; i < data.length; i += 4) {
        const r = data[i];
        const g = data[i + 1];
        const b = data[i + 2];
        const brightness = (r + g + b) / 3;

        if (brightness < 150) {
            data[i] = data[i + 1] = data[i + 2] = 0;
        } else {
            data[i] = data[i + 1] = data[i + 2] = 255;
        }
    }

    function dilate(data, width, height) {
        let copy = new Uint8ClampedArray(data);
        for (let y = 1; y < height - 1; y++) {
            for (let x = 1; x < width - 1; x++) {
                let i = (y * width + x) * 4;
                if (copy[i] === 0) {
                    for (let dy = -1; dy <= 1; dy++) {
                        for (let dx = -1; dx <= 1; dx++) {
                            let ni = ((y + dy) * width + (x + dx)) * 4;
                            data[ni] = data[ni + 1] = data[ni + 2] = 0;
                        }
                    }
                }
            }
        }
    }

    dilate(data, canvas.width, canvas.height);
    ctx.putImageData(imageData, 0, 0);
}

document.getElementById("upload").addEventListener("change", function(e) {
    const file = e.target.files[0];
    if (!file) return;

    const img = new Image();
    img.onload = function() {
        enhanceText(img);
    }
    img.src = URL.createObjectURL(file);
});
</script>

</body>
</html>
