<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>استخراج متن از تصویر (خاکستری)</title>
<script src="https://cdn.jsdelivr.net/npm/tesseract.js@4.0.2/dist/tesseract.min.js"></script>
<style>
body { font-family: sans-serif; text-align: center; margin-top: 50px; }
#canvas { max-width: 90%; border: 1px solid #000; margin-top: 20px; }
textarea { width: 90%; height: 200px; margin-top: 20px; font-size: 1rem; }
</style>
</head>
<body>

<h1>استخراج متن از تصویر قرآن (خاکستری)</h1>
<input type="file" id="upload" accept="image/*"><br>
<canvas id="canvas"></canvas><br>
<button id="extract">استخراج متن</button><br>
<textarea id="output" placeholder="متن استخراج شده اینجا نمایش داده می‌شود"></textarea>

<script>
let imgElement = new Image();

document.getElementById("upload").addEventListener("change", function(e){
    const file = e.target.files[0];
    if(!file) return;

    imgElement.onload = () => {
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        canvas.width = imgElement.width;
        canvas.height = imgElement.height;
        ctx.drawImage(imgElement, 0, 0);

        // تبدیل تصویر به خاکستری برای OCR-friendly شدن
        let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        let data = imageData.data;
        for (let i = 0; i < data.length; i += 4) {
            let avg = (data[i] + data[i+1] + data[i+2]) / 3;
            data[i] = data[i+1] = data[i+2] = avg;
        }
        ctx.putImageData(imageData, 0, 0);
    }

    imgElement.src = URL.createObjectURL(file);
});

document.getElementById("extract").addEventListener("click", function(){
    Tesseract.recognize(
        imgElement,
        'ara', // زبان عربی
        { logger: m => console.log(m) }
    ).then(({ data: { text } }) => {
        document.getElementById("output").value = text;
    });
});
</script>

</body>
</html>
